set(PLUGIN_NAME RemoteControl)

include(module) # Setup default stuff needed for the cmake framework thingy.

set(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_KEYMAP "keymap.json" CACHE STRING "Default keymap")
set(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP "NexusIR.json" CACHE STRING "Nexus IR keymap")

find_package(BcmNxServer QUIET)
find_package(VirtualInput QUIET)

set(PLUGIN_DEFINITIONS)

set(PLUGIN_SOURCES
	Module.cpp
	RemoteControl.cpp
	RemoteAdministrator.cpp
)

if(LIBVIRTUALINPUT_FOUND)
	list(APPEND PLUGIN_DEFINITIONS VIRTUAL_INPUT_ENABLED)
endif()

if (WPEFRAMEWORK_PLUGIN_REMOTECONTROL_DEVINPUT)
	list(APPEND PLUGIN_DEPENDENCIES udev)
	list(APPEND PLUGIN_SOURCES LinuxDevice.cpp)
endif()

if(LIBNXSERVER_FOUND)
	if (WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS)
		list(APPEND PLUGIN_DEPENDENCIES_INCLUDE_DIRS ${LIBNXCLIENT_INCLUDE_DIRS})
		list(APPEND PLUGIN_DEPENDENCIES ${LIBNEXUS_LIBRARY} ${LIBNXCLIENT_LIBRARY})
		list(APPEND PLUGIN_SOURCES IRRemote.cpp)
		list(APPEND PLUGIN_DEFINITIONS IR_ENABLED)
		if(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_HOST)
			set(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP "${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_HOST}-IRRemoteKeyMap-${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRMODE}.json")
		else(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_HOST)
			set(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP "IRRemoteKeyMap-${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRMODE}.json")
		endif(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_HOST)
		if(NOT EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP}")
			set(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP "IRRemoteKeyMap-${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRMODE}.json")
		endif()
	endif(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS)
endif()

set(PLUGIN_INPUT
	${PLUGIN_SOURCES}
	${PLUGIN_INCLUDES})

include(default_targets) # This is a regular plugin no need to edit the defaults

if (WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS AND WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP AND EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP}" AND NOT IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP}")
	message("Nexus IR device key map file: " ${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP})
	install(FILES KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_IRNEXUS_KEYMAP} DESTINATION ${CMAKE_INSTALL_PREFIX}/share/WPEFramework/RemoteControl)
endif()

if (WPEFRAMEWORK_PLUGIN_REMOTECONTROL_DEVINPUT AND WPEFRAMEWORK_PLUGIN_REMOTECONTROL_DEVINPUT_KEYMAP AND EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_DEVINPUT_KEYMAP}" AND NOT IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_DEVINPUT_KEYMAP}")
	message("LinuxDevice device key map file: " ${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_DEVINPUT_KEYMAP})
	install(FILES KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_DEVINPUT_KEYMAP} DESTINATION ${CMAKE_INSTALL_PREFIX}/share/WPEFramework/RemoteControl)
endif()

if(EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_KEYMAP}" AND NOT IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_KEYMAP}")
	message("Use keymap file: " ${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_KEYMAP})
	install(
		FILES KeyMaps/${WPEFRAMEWORK_PLUGIN_REMOTECONTROL_KEYMAP}
		DESTINATION ${CMAKE_INSTALL_PREFIX}/share/WPEFramework/RemoteControl)
else()
	set(WPEFRAMEWORK_PLUGIN_REMOTECONTROL_KEYMAP "keymap.json")
	install(
		FILES KeyMaps/keymap.json
		DESTINATION ${CMAKE_INSTALL_PREFIX}/share/WPEFramework/RemoteControl
		COMPONENT ${MODULE_NAME})
endif()

write_config(${PLUGIN_NAME})